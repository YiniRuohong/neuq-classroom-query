<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>ä¸œç§¦ç©ºé—²æ•™å®¤è¡¨</title>
  <style>
    body { max-width: 1200px; margin:0 auto; font-family: monospace; font-size:13px; line-height:1.6; color:#333; }
    ul { list-style: none; padding:0; text-align:center; }
    li { margin: 15px 0; }
    table { margin:0 auto; border-collapse: collapse; width:100%; }
    table, th, td { border:1px solid #000; }
    th { font-size:12px; }
    td { padding:5px; }
  </style>
</head>
<body>
  <div style="text-align:center;margin-bottom:20px;">
    <label for="buildingSelect">åˆ‡æ¢æ•™å­¦æ¥¼ï¼š</label>
    <select id="buildingSelect"></select>
  </div>
  <h1 id="title">ç©ºé—²æ•™å®¤è¡¨</h1>
  <p id="timestamp"></p>
  <hr>
  <ul id="slots"></ul>
<script>
const buildingMap = {
  gongxueguan:{name:'å·¥å­¦é¦†',number:'1'},
  jichulou:{name:'åŸºç¡€æ¥¼',number:'2'},
  shiyanlou:{name:'ç»¼åˆå®éªŒæ¥¼',number:'3'},
  dizhilou:{name:'åœ°è´¨æ¥¼',number:'4'},
  guanlilou:{name:'ç®¡ç†æ¥¼',number:'5'},
  dahuiguan:{name:'å¤§å­¦ä¼šé¦†',number:'6'},
  jiusy:{name:'æ—§å®éªŒæ¥¼',number:'7'},
  renwenlou:{name:'äººæ–‡æ¥¼',number:'8'},
  keji:{name:'ç§‘æŠ€æ¥¼',number:'9'}
};
const timeSlots = [
  {label:'ğŸ™ä¸Šåˆç¬¬1-2èŠ‚',suffix:'1-2'},
  {label:'ğŸ™ä¸Šåˆç¬¬3-4èŠ‚',suffix:'3-4'},
  {label:'ğŸŒ‡ä¸‹åˆç¬¬5-6èŠ‚',suffix:'5-6'},
  {label:'ğŸŒ‡ä¸‹åˆç¬¬7-8èŠ‚',suffix:'7-8'},
  {label:'ğŸ™æ˜¼é—´ç¬¬1-8èŠ‚',suffix:'1-8'},
  {label:'ğŸŒƒæ™šä¸Šç¬¬9-10èŠ‚',suffix:'9-10'},
  {label:'ğŸŒƒæ™šä¸Šç¬¬11-12èŠ‚',suffix:'11-12'}
];
const select = document.getElementById('buildingSelect');
for(const code in buildingMap){
  const opt=document.createElement('option');
  opt.value=code; opt.textContent=buildingMap[code].name;
  select.appendChild(opt);
}
function processData(data, buildingName){
  const floors={'1F':[], '2F':[], '3F':[], '4F':[], '5F':[], '6F':[], '7F':[]};
  if(Array.isArray(data)){
    for(const e of data){
      if(e['æ•™å­¦æ¥¼']===buildingName && e['åç§°']){
        let name=e['åç§°'];
        if(name.startsWith(buildingName)) name=name.slice(buildingName.length).trim();
        if(/^\d+$/.test(name)){
          const f=name.charAt(0)+'F';
          if(floors[f]) floors[f].push(name);
        }
      }
    }
  }
  for(const f in floors){
    if(floors[f].length) floors[f]=floors[f].sort((a,b)=>parseInt(a)-parseInt(b)).join(' ');
    else floors[f]='æ— ';
  }
  return floors;
}
function buildTables(){
  const ul=document.getElementById('slots');
  ul.innerHTML='';
  for(const slot of timeSlots){
    const liLabel=document.createElement('li');
    liLabel.style.fontWeight='bold';
    liLabel.style.fontSize='18px';
    liLabel.textContent=slot.label;
    ul.appendChild(liLabel);
    const liTable=document.createElement('li');
    const table=document.createElement('table');
    const thead=document.createElement('thead');
    thead.innerHTML='<tr><th style="font-size:12px">æ¥¼å±‚</th><th style="font-size:12px">æ•™å®¤</th></tr>';
    table.appendChild(thead);
    const tbody=document.createElement('tbody');
    ['1F','2F','3F','4F','5F','6F','7F'].forEach(f=>{
      const tr=document.createElement('tr');
      const tdFloor=document.createElement('td');
      tdFloor.style.fontWeight='bold';
      tdFloor.style.fontSize='16px';
      tdFloor.textContent=f;
      const tdRooms=document.createElement('td');
      tdRooms.textContent='åŠ è½½ä¸­...';
      tdRooms.setAttribute('data-floor',f);
      tr.appendChild(tdFloor); tr.appendChild(tdRooms);
      tbody.appendChild(tr);
    });
    table.appendChild(tbody); liTable.appendChild(table); ul.appendChild(liTable);
  }
}
async function loadBuilding(code){
  const info=buildingMap[code]; if(!info) return;
  document.getElementById('title').textContent=new Date().toLocaleDateString('zh-CN')+' ğŸ«ä¸œç§¦'+info.name+'ç©ºé—²æ•™å®¤è¡¨';
  document.getElementById('timestamp').textContent='æœ¬ç©ºé—²æ•™å®¤è¡¨æ›´æ–°äº '+new Date().toLocaleString('zh-CN', {hour12:false});
  const tables=document.querySelectorAll('#slots table');
  for(let i=0;i<timeSlots.length;i++){
    const slot=timeSlots[i];
    const paths=[
      `output/classroom_results_${info.number}_${slot.suffix}.json`,
      `output/classroom_results_${slot.suffix}.json`
    ];
    let data=null;
    for(const p of paths){
      try{
        const res=await fetch(p);
        if(res.ok){
          data=await res.json();
          break;
        }
      }catch(e){
        // ignore and try next path
      }
    }
    if(data){
      const floors=processData(data, info.name);
      const rows=tables[i].querySelectorAll('tbody tr');
      rows.forEach(row=>{
        const f=row.querySelector('td[data-floor]');
        if(f){
          const floor=f.getAttribute('data-floor');
          row.lastChild.textContent=floors[floor]||'æ— ';
        }
      });
    }else{
      const rows=tables[i].querySelectorAll('tbody tr td[data-floor]');
      rows.forEach(cell=>cell.parentNode.lastChild.textContent='æš‚æ— æ•°æ®');
    }
  }
}
buildTables();
select.addEventListener('change',()=>loadBuilding(select.value));
loadBuilding(Object.keys(buildingMap)[0]);
</script>
</body>
</html>
